version: "3.8"
services:
  site:
    build:
      args:
        - db_arg=1
      context: .
      dockerfile: SiteDockerfile
    command: bash -c "pdm run update db && mkdocs build"
    volumes:
      - ./docs:/app/docs
      - site-volume:/app/src/site
      - database-volume:/app/src/database
  server:
    build:
      context: .
      dockerfile: ServerDockerfile
    ports:
      - "8001:8000"
    volumes:
      - site-volume:/app/src/site
      - database-volume:/app/src/database
    command: pdm run manage runserver 0.0.0.0:8000
volumes:
  site-volume:
  database-volume:
